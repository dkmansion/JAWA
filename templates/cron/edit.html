{% extends "shared/_layout.html" %}
{% block title %}Edit Timed Automation{% endblock %}
{% block content %}
    <div class="test-links sub_links sticky-top">
        <div class="stat"><a href="/cron/new">New Timed Job</a></div>
        <div class="stat"><a href="/cron">All Timed Automations</a></div>
    </div>



    <div class="form-container">
        <form action="/cron/edit?name={{ edit_name }}" method="POST" class="table-view"
              enctype="multipart/form-data">
            <div class="overflow-auto" style="max-height: 60vh; margin: auto">
                <h1>Edit {% if request.args.get('name') %}{{ request.args.get('name') }}{% else %}Timed
                    Automation{% endif %}</h1>
                <input type="text" class="form-control" placeholder="Edit Timed Automation Name (optional)"
                       name="cron_name" pattern="[^' ']+"
                       required autofocus value="{{ request.args.get('name') }}"
                       oninvalid="this.setCustomValidity('Single-string name required. (i.e. single_string or string)')"></br>
                <textarea name="description" rows=3 type="text" placeholder="Description (optional)"
                          class="form-control">{{ description }}</textarea><br>

                <label class="form-check-label">Frequency:</label>
                <select name="frequency" class="form-control"
                        onchange="java_script_:show(this.options[this.selectedIndex].value)">
                    <option value=""></option>
                    <option value="everyhour">Every Hour</option>
                    <option value="everyday">Every Day</option>
                    <option value="everyweek">Every Week</option>
                    <option value="everymonth">Every Month</option>
                    <option value="custom">Custom</option>
                </select></br>

                <div id="hiddenDiv" style="display:none">
                    <label>At what time?</label>
                    <select name="daytime">
                        <option value=""></option>
                        {% for hour in hours %}
                            <option value="{{ hour.id }}">{{ hour.value }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div id="hiddenDivTwo" style="display:none">
                    <label>On what day?</label>
                    <select name="weekday">
                        <option value=""></option>
                        {% for day in days %}
                            <option value="{{ day.cron }}">{{ day.value }}</option>
                        {% endfor %}
                    </select>
                    </br>
                    <label>At what time?</label>
                    <select name="weektime">
                        <option value=""></option>
                        {% for hour in hours %}
                            <option value="{{ hour.id }}">{{ hour.value }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div id="hiddenDivThree" style="display:none">
                    <label>On what day of the month?</label>
                    <select name="monthday">
                        <option value=""></option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                    </select>
                    </br>
                    <label>At what time?</label>
                    <select name="monthtime">
                        <option value=""></option>
                        {% for hour in hours %}
                            <option value="{{ hour.id }}">{{ hour.value }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div id="hiddenDivFour" style="display:none">
                </div>
            </div>
            <div id="hiddenDivFive" style="display:none">
                <label>Set your custom frequency:</label>
                <input type="text" name="customfreq" pattern="^((((\d+,)+\d+|(\d+(\/|-|#)\d+)|\d+L?|\*(\/\d+)?|L(-\d+)?|\?|[A-Z]{3}(-[A-Z]{3})?) ?){5,7})$">
            </div>
            <div class="d-flex justify-content-center">
                <br><b>Script: &nbsp</b>
                <input type="file" name="script" pattern="[^' ']+"
                       accept=".sh,.py,.rs,.rlib,.swift,.cgi,.pl,.rb"
                       oninvalid="this.setCustomValidity('A script is required. Spaces cannot be in the name of the script.')"></b>
            </div>

            <div class="d-flex justify-content-center btn-padded">

                <button style="overflow: visible !important; height: 0 !important; width: 0 !important; margin: 0 !important; border: 0 !important; padding: 0 !important; display: block !important;"
                        type="submit" value=""/>

                <button type=submit name="button_choice" value="Delete" class="btn btn-danger"
                        style="margin: 5px; padding: 5px; width: 150px"
                >

                    Delete

                </button>
                <button type=submit value="Custom_New" class="btn btn-secondary "
                        style="margin: 5px; padding: 5px; width: 150px">

                    Save

                </button>
            </div>
            {% if success_msg %}

                <h3 class="alert-success">Success!</h3>
                <div class="form-container alert-warning">
                <div>{{ success_msg }} <br></div>
            {% endif %}
        </form>
    </div>
{% endblock %}
{% block additional_js %}
    <script text="text/javascript">

        function show(aval) {
            if (aval == "everyday") {
                hiddenDiv.style.display = 'inline-block';
                hiddenDivTwo.style.display = 'none';
                hiddenDivFour.style.display = 'none';
                hiddenDivThree.style.display = 'none';
            } else if (aval == "everyweek") {
                hiddenDivTwo.style.display = 'inline-block';
                hiddenDiv.style.display = 'none';
                hiddenDivFour.style.display = 'none';
                hiddenDivThree.style.display = 'none';
            } else if (aval == "everymonth") {
                hiddenDivThree.style.display = 'inline-block';
                hiddenDiv.style.display = 'none';
                hiddenDivTwo.style.display = 'none';
                hiddenDivFour.style.display = 'none';
            } else if (aval == "custom") {
                hiddenDiv.style.display = 'none';
                hiddenDivTwo.style.display = 'none';
                hiddenDivThree.style.display = 'none';
                hiddenDivFour.style.display = 'none';
                hiddenDivFive.style.display = 'inline-block';
            } else if (aval == "") {
                hiddenDivFour.style.display = 'none';
                hiddenDivThree.style.display = 'none';
                hiddenDiv.style.display = 'none';
                hiddenDivTwo.style.display = 'none';
            } else {
                hiddenDiv.style.display = 'none';
                hiddenDivTwo.style.display = 'none';
                hiddenDivFour.style.display = 'none';
                hiddenDivThree.style.display = 'none';
            }
        }

    </script>
{% endblock %}